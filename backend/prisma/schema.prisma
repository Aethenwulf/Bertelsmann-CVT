generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["cia"]
}

model departments {
  id               Int                @id @default(autoincrement())
  name             String             @unique @db.VarChar(100)
  description      String?
  created_at       DateTime?          @default(now()) @db.Timestamp(6)
  updated_at       DateTime?          @default(now()) @db.Timestamp(6)
  is_deleted       Boolean?           @default(false)
  incident_reports incident_reports[]
  users            users[]

  @@schema("cia")
}

model roles {
  id          Int       @id @default(autoincrement())
  name        String    @unique @db.VarChar(100)
  description String?
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
  is_deleted  Boolean?  @default(false)
  users       users[]

  @@schema("cia")
}

model users {
  id                                                              Int                @id @default(autoincrement())
  first_name                                                      String             @db.VarChar(100)
  last_name                                                       String             @db.VarChar(100)
  email                                                           String             @unique @db.VarChar(150)
  phone_number                                                    String?            @db.VarChar(20)
  birthday                                                        DateTime?          @db.Date
  role_id                                                         Int?
  department_id                                                   Int?
  country_id                                                      Int?
  region_id                                                       Int?
  city_id                                                         Int?
  status                                                          String?            @default("ACTIVE") @db.VarChar(20)
  last_seen                                                       DateTime?          @db.Timestamp(6)
  last_login                                                      DateTime?          @db.Timestamp(6)
  created_at                                                      DateTime?          @default(now()) @db.Timestamp(6)
  updated_at                                                      DateTime?          @default(now()) @db.Timestamp(6)
  is_deleted                                                      Boolean?           @default(false)
  actions_taken                                                   actions_taken[]
  activity_logs                                                   activity_logs[]
  audit_logs                                                      audit_logs[]
  evidences                                                       evidences[]
  incident_reports_incident_reports_officiating_officer_idTousers incident_reports[] @relation("incident_reports_officiating_officer_idTousers")
  incident_reports_incident_reports_reporter_idTousers            incident_reports[] @relation("incident_reports_reporter_idTousers")
  incident_reports_incident_reports_respondent_idTousers          incident_reports[] @relation("incident_reports_respondent_idTousers")
  incident_reports_incident_reports_supervisor_idTousers          incident_reports[] @relation("incident_reports_supervisor_idTousers")
  user_auth                                                       user_auth[]
  cities                                                          cities?            @relation(fields: [city_id], references: [id], onUpdate: NoAction, map: "fk_users_city")
  countries                                                       countries?         @relation(fields: [country_id], references: [id], onUpdate: NoAction, map: "fk_users_country")
  departments                                                     departments?       @relation(fields: [department_id], references: [id], onUpdate: NoAction)
  regions                                                         regions?           @relation(fields: [region_id], references: [id], onUpdate: NoAction)
  roles                                                           roles?             @relation(fields: [role_id], references: [id], onUpdate: NoAction)

  @@index([email], map: "idx_users_email")
  @@schema("cia")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model cities {
  id         Int       @id @default(autoincrement())
  region_id  Int
  name       String    @db.VarChar(150)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
  is_deleted Boolean?  @default(false)
  regions    regions   @relation(fields: [region_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users[]

  @@schema("cia")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model countries {
  id         Int       @id @default(autoincrement())
  name       String    @unique @db.VarChar(150)
  code       String?   @db.VarChar(10)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
  is_deleted Boolean?  @default(false)
  regions    regions[]
  users      users[]

  @@schema("cia")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model regions {
  id         Int       @id @default(autoincrement())
  country_id Int
  name       String    @db.VarChar(150)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
  is_deleted Boolean?  @default(false)
  cities     cities[]
  countries  countries @relation(fields: [country_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users[]

  @@schema("cia")
}

model actions_taken {
  id              Int               @id @default(autoincrement())
  report_id       Int?
  action_taken_by Int?
  action_type     String?           @db.VarChar(100)
  notes           String?
  action_date     DateTime?         @default(now()) @db.Timestamp(6)
  created_at      DateTime?         @default(now()) @db.Timestamp(6)
  updated_at      DateTime?         @default(now()) @db.Timestamp(6)
  is_deleted      Boolean?          @default(false)
  users           users?            @relation(fields: [action_taken_by], references: [id], onUpdate: NoAction)
  coc_reports     incident_reports? @relation(fields: [report_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("cia")
}

model audit_logs {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  action     String    @db.VarChar(255)
  table_name String?   @db.VarChar(100)
  record_id  Int?
  details    String?
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@schema("cia")
}

model evidences {
  id          Int               @id @default(autoincrement())
  report_id   Int?
  file_path   String
  file_type   String?           @db.VarChar(50)
  uploaded_by Int?
  uploaded_at DateTime?         @default(now()) @db.Timestamp(6)
  is_deleted  Boolean?          @default(false)
  coc_reports incident_reports? @relation(fields: [report_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users       users?            @relation(fields: [uploaded_by], references: [id], onUpdate: NoAction)

  @@schema("cia")
}

model user_auth {
  id            Int       @id @default(autoincrement())
  user_id       Int
  username      String    @unique @db.VarChar(100)
  password_hash String
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  is_deleted    Boolean?  @default(false)
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([username], map: "idx_user_auth_username")
  @@schema("cia")
}

model activity_logs {
  id             Int       @id @default(autoincrement())
  user_id        Int?
  action_type    String    @db.VarChar(100)
  table_name     String?   @db.VarChar(100)
  record_id      Int?
  changed_fields Json?
  machine_id     String?   @db.VarChar(255)
  device_type    String?   @db.VarChar(50)
  ip_address     String?   @db.VarChar(100)
  created_at     DateTime? @default(now()) @db.Timestamp(6)
  updated_at     DateTime? @default(now()) @db.Timestamp(6)
  is_deleted     Boolean?  @default(false)
  users          users?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([action_type], map: "idx_activity_logs_action_type")
  @@index([created_at], map: "idx_activity_logs_created_at")
  @@index([user_id], map: "idx_activity_logs_user_id")
  @@schema("cia")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model incident_reports {
  id                                                   Int             @id @default(autoincrement())
  report_type                                          String          @default("EIN") @db.VarChar(20)
  reporter_id                                          Int?
  respondent_id                                        Int?
  supervisor_id                                        Int?
  officiating_officer_id                               Int?
  department_id                                        Int?
  job_title                                            String?         @db.VarChar(150)
  category_id                                          Int?
  subcategory_id                                       Int?
  subcategory_details                                  String?         @db.VarChar(500)
  coaching                                             Boolean?        @default(false)
  verbal_warning                                       Boolean?        @default(false)
  written_warning                                      Boolean?        @default(false)
  suspension_no_pay                                    Boolean?        @default(false)
  final_written_warning                                Boolean?        @default(false)
  termination                                          Boolean?        @default(false)
  consequence_id                                       Int?
  last_infraction_date                                 DateTime?       @db.Date
  incident_date                                        DateTime?       @default(now()) @db.Timestamp(6)
  location                                             String?
  status                                               String?         @default("PENDING") @db.VarChar(20)
  employee_signature                                   String?
  employee_signature_date                              DateTime?       @db.Date
  manager_signature                                    String?
  manager_signature_date                               DateTime?       @db.Date
  witness_signature                                    String?
  witness_signature_date                               DateTime?       @db.Date
  created_at                                           DateTime?       @default(now()) @db.Timestamp(6)
  updated_at                                           DateTime?       @default(now()) @db.Timestamp(6)
  is_deleted                                           Boolean?        @default(false)
  actions_taken                                        actions_taken[]
  evidences                                            evidences[]
  lookups_incident_reports_category_idTolookups        lookups?        @relation("incident_reports_category_idTolookups", fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lookups_incident_reports_consequence_idTolookups     lookups?        @relation("incident_reports_consequence_idTolookups", fields: [consequence_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  departments                                          departments?    @relation(fields: [department_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_incident_reports_officiating_officer_idTousers users?          @relation("incident_reports_officiating_officer_idTousers", fields: [officiating_officer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_incident_reports_reporter_idTousers            users?          @relation("incident_reports_reporter_idTousers", fields: [reporter_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_incident_reports_respondent_idTousers          users?          @relation("incident_reports_respondent_idTousers", fields: [respondent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lookups_incident_reports_subcategory_idTolookups     lookups?        @relation("incident_reports_subcategory_idTolookups", fields: [subcategory_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_incident_reports_supervisor_idTousers          users?          @relation("incident_reports_supervisor_idTousers", fields: [supervisor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("cia")
}

model lookups {
  id                                                        Int                @id @default(autoincrement())
  group_name                                                String             @db.VarChar(100)
  parent_id                                                 Int?
  name                                                      String             @db.VarChar(150)
  description                                               String?
  sort_order                                                Int?
  is_active                                                 Boolean?           @default(true)
  created_at                                                DateTime?          @default(now()) @db.Timestamp(6)
  updated_at                                                DateTime?          @default(now()) @db.Timestamp(6)
  incident_reports_incident_reports_category_idTolookups    incident_reports[] @relation("incident_reports_category_idTolookups")
  incident_reports_incident_reports_consequence_idTolookups incident_reports[] @relation("incident_reports_consequence_idTolookups")
  incident_reports_incident_reports_subcategory_idTolookups incident_reports[] @relation("incident_reports_subcategory_idTolookups")
  lookups                                                   lookups?           @relation("lookupsTolookups", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_lookups                                             lookups[]          @relation("lookupsTolookups")

  @@schema("cia")
}
